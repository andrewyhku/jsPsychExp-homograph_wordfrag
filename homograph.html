<!DOCTYPE html>
<html>

<head>
  
  <script src="../jspsych.js"></script>
  <script src="../plugins/jspsych-html-keyboard-response.js"></script>
  <link rel="stylesheet" href="../css/jspsych.css"></link>
  <style>
  .stimulus { font-size: 32px; }
  </style>
</head>

<script>
  var timeline = [];

  var instructions = {
    type: 'html-keyboard-response', 
    //please refine the instruction below, use <p> and </p> to surround every line"
    stimulus: '<p>Blah Blah Blah</p>'+
      '<p>Blah Blah Blah Blah</p>'+
      '<p>When you are ready to begin, press Y or N.</p>',
    choices: ['y','n']
  }
  timeline.push(instructions);

  var stimuli = [
    {prime: 'woman', valence: 'neutral', stem: 'gent_eman', correct_ans:'a'},
    {prime: 'hey', valence: 'neutral', stem: 'hel_o', correct_ans:'l'}
  
  ];

  var fixation = {
    type: 'html-keyboard-response',
    stimulus: '<p class="stimulus">+</p>',
    choices: jsPsych.NO_KEYS,
    trial_duration: 1000,
    post_trial_gap: 500
  }

  function trials(stimuli) {
      return {
        timeline_variables: stimuli,
        randomize_order: true,
        timeline: [
        fixation,
        {
            type: 'html-keyboard-response',
            stimulus: function(){ return "<p class='stimulus'>"+jsPsych.timelineVariable('prime',true)+"</p <p class='stimulus'></p>"; },
            choices: jsPsych.NO_KEYS,
            trial_duration: 750,
        },
        {
            type: 'html-keyboard-response',
            stimulus: function(){ return "<p class='stimulus'>"+jsPsych.timelineVariable('prime',true)+"</p>" + 
            "<p class='stimulus'>"+jsPsych.timelineVariable('stem',true)+"</p>"; },
            choices: [' '],
            trial_duration: 10000
        },
        {
            type: 'html-keyboard-response',
            stimulus: function(){ return "<p class='stimulus'>What is the missing letter?</p>"; },
            trial_duration: 6000,
            data: function(){
            return {
                word_prime: jsPsych.timelineVariable('prime',true),
                word_stem: jsPsych.timelineVariable('stem',true),
                valence: jsPsych.timelineVariable('valence',true),
                correctans : jsPsych.timelineVariable('correct_ans',true)
            }
          },
          on_finish: function(data){
              if (data.key_press == jsPsych.pluginAPI.convertKeyCharacterToKeyCode(jsPsych.timelineVariable('correct_ans',true))) {
                  data.correct = true; 
              } else {
                  data.correct = false;
              }
          }
        }
        ]
      }
  }

  timeline.push(trials(stimuli));

  var debrief = {
    type: 'html-keyboard-response',
    stimulus: "<p>blah blah blah DONE</p>" ,
    prompt: "<p>press any key to take a look on the data</p>" 
  }
  timeline.push(debrief);


  jsPsych.init({
    timeline: timeline,
    on_finish: function() {
      jsPsych.data.displayData();
    },
    default_iti: 250
  });
  
</script>

</html>
